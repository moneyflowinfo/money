<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>자산 시장 대시보드</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    /* 기존 스타일 그대로 유지 (생략) */
    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --text-primary: #e2e8f0;
      --text-secondary: #94a3b8;
      --accent: #3b82f6;
      --positive: #10b981;
      --negative: #ef4444;
      --card-bg: #1e293b;
    }

    body { background: var(--bg-primary); color: var(--text-primary); font-family: 'Pretendard', system-ui, sans-serif; min-height: 100vh; }
    /* ... 나머지 스타일은 이전과 동일 ... */
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- 상단 헤더 -->
  <header class="bg-gray-900/80 backdrop-blur-md border-b border-gray-800 sticky top-0 z-50">
    <div class="header-container max-w-7xl mx-auto">
      <div class="header-left">
        <h1 style="color: var(--text-primary);">Money Flow 자산 흐름</h1>
        <p style="color: var(--text-secondary);">
          주요 자산 가격 현황 및 지표
          <span class="ml-2 px-1.5 py-0.5 rounded text-xs bg-[var(--bg-secondary)]">Updated: 실시간</span>
        </p>
      </div>

      <div class="header-right">
        <div class="card indicator-card hidden md:block">
          <div class="label">$ 원/달러 환율</div>
          <div class="value" id="usdkrw-value">1449.4원</div>
          <div class="change" id="usdkrw-change">+0.27% (+3.96원)</div>
        </div>
        <div class="card indicator-card hidden md:block">
          <div class="label">업비트 USDT</div>
          <div class="value" id="upbit-usdt-value">₩1,477</div>
          <div class="change" id="upbit-usdt-change">-0.14% (-2원)</div>
        </div>
        <div class="card indicator-card hidden md:block">
          <div class="label">빗썸 USDT</div>
          <div class="value" id="bithumb-usdt-value">₩1,477</div>
          <div class="change" id="bithumb-usdt-change">-0.07% (-1원)</div>
        </div>
        <div class="card indicator-card hidden md:block">
          <div class="label">김치프리미엄 (BTC)</div>
          <div class="value positive" id="kimchi-premium">+1.88%</div>
        </div>
        <button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-800 transition">
          <i id="theme-icon" class="fas fa-moon text-lg"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- 나머지 HTML 구조는 이전과 동일 (원자재, 미국 주식, 한국 주식, 크립토 섹션) -->

  <!-- 크립토 섹션 내 비트코인과 이더리움 부분 (id 유지) -->
  <!-- ... 생략 ... -->

  <!-- 스크립트 -->
  <script>
    // 테마 토글 (기존 그대로)
    const toggleBtn = document.getElementById('theme-toggle');
    const icon = document.getElementById('theme-icon');
    const html = document.documentElement;

    toggleBtn.addEventListener('click', () => {
      if (html.getAttribute('data-theme') === 'dark') {
        html.setAttribute('data-theme', 'light');
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
      } else {
        html.setAttribute('data-theme', 'dark');
        icon.classList.remove('fa-sun');
        icon.classList.add('fa-moon');
      }
    });

    if (html.getAttribute('data-theme') === 'light') {
      icon.classList.remove('fa-moon');
      icon.classList.add('fa-sun');
    }

    // 모든 데이터 업데이트 함수
    async function updateAllData() {
      try {
        // 1. CoinGecko: BTC + ETH
        const cgRes = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd,krw&include_24hr_change=true');
        const cgData = await cgRes.json();

        const btc = cgData.bitcoin;
        if (btc) {
          const usd = btc.usd.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
          const krw = Math.floor(btc.krw).toLocaleString('ko-KR');
          const chg = btc.usd_24h_change.toFixed(2);
          const pos = chg >= 0;

          document.getElementById('btc-price').innerHTML = `<div class="text-lg font-bold">$${usd}</div><div class="text-base font-bold ml-2">₩${krw}</div>`;
          const btcChg = document.getElementById('btc-change');
          btcChg.className = `text-xs flex justify-center items-center space-x-1 mt-1 ${pos ? 'positive' : 'negative'}`;
          btcChg.innerHTML = `<i class="fas fa-arrow-trend-${pos ? 'up' : 'down'}"></i><span>${pos ? '+' : ''}${chg}%</span>`;
        }

        const eth = cgData.ethereum;
        if (eth) {
          const usd = eth.usd.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 2 });
          const krw = Math.floor(eth.krw).toLocaleString('ko-KR');
          const chg = eth.usd_24h_change.toFixed(2);
          const pos = chg >= 0;

          document.getElementById('eth-price').innerHTML = `<div class="text-lg font-bold">$${usd}</div><div class="text-base font-bold ml-2">₩${krw}</div>`;
          const ethChg = document.getElementById('eth-change');
          ethChg.className = `text-xs flex justify-center items-center space-x-1 mt-1 ${pos ? 'positive' : 'negative'}`;
          ethChg.innerHTML = `<i class="fas fa-arrow-trend-${pos ? 'up' : 'down'}"></i><span>${pos ? '+' : ''}${chg}%</span>`;
        }

        // 2. 환율 USD/KRW (frankfurter.app 사용 - 전일 종가 대비 변동)
        const fxRes = await fetch('https://api.frankfurter.app/latest?from=USD&to=KRW');
        const fxData = await fxRes.json();
        const currentKrw = fxData.rates.KRW.toFixed(1);

        // 전일 종가 가져오기 (frankfurter는 과거 데이터도 지원)
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toISOString().split('T')[0];
        const prevRes = await fetch(`https://api.frankfurter.app/${yesterdayStr}?from=USD&to=KRW`);
        const prevData = await prevRes.json();
        const prevKrw = prevData.rates.KRW.toFixed(1);

        const fxChgPct = ((currentKrw - prevKrw) / prevKrw * 100).toFixed(2);
        const fxChgWon = (currentKrw - prevKrw).toFixed(1);
        const fxPos = fxChgPct >= 0;

        document.getElementById('usdkrw-value').textContent = `${currentKrw}원`;
        const fxChgEl = document.getElementById('usdkrw-change');
        fxChgEl.textContent = `${fxPos ? '+' : ''}${fxChgPct}% (${fxPos ? '+' : ''}${fxChgWon}원)`;
        fxChgEl.className = `change ${fxPos ? 'positive' : 'negative'}`;

        // 3. 업비트 BTC-KRW (김치프리미엄 계산용) + USDT
        const upRes = await fetch('https://api.upbit.com/v1/ticker?markets=KRW-BTC,KRW-USDT');
        const upData = await upRes.json();

        let upBtcKrw = 0;
        let upUsdt = 0;
        upData.forEach(item => {
          if (item.market === 'KRW-BTC') upBtcKrw = item.trade_price;
          if (item.market === 'KRW-USDT') upUsdt = item.trade_price;
        });

        // 업비트 USDT
        if (upUsdt) {
          const price = Math.round(upUsdt).toLocaleString('ko-KR');
          const chgRate = (upData.find(d => d.market === 'KRW-USDT').signed_change_rate * 100).toFixed(2);
          const chgWon = Math.round(upData.find(d => d.market === 'KRW-USDT').signed_change_price).toLocaleString('ko-KR');
          const pos = chgRate >= 0;

          document.getElementById('upbit-usdt-value').textContent = `₩${price}`;
          const upChgEl = document.getElementById('upbit-usdt-change');
          upChgEl.textContent = `${pos ? '+' : ''}${chgRate}% (${pos ? '+' : ''}${chgWon}원)`;
          upChgEl.className = `change ${pos ? 'positive' : 'negative'}`;
        }

        // 4. 빗썸 USDT-KRW
        const bhRes = await fetch('https://api.bithumb.com/public/ticker/USDT_KRW');
        const bhData = await bhRes.json();
        if (bhData.status === '0000') {
          const price = Math.round(bhData.data.closing_price).toLocaleString('ko-KR');
          const chgRate = ((bhData.data.closing_price - bhData.data.opening_price) / bhData.data.opening_price * 100).toFixed(2);
          const chgWon = Math.round(bhData.data.closing_price - bhData.data.opening_price).toLocaleString('ko-KR');
          const pos = chgRate >= 0;

          document.getElementById('bithumb-usdt-value').textContent = `₩${price}`;
          const bhChgEl = document.getElementById('bithumb-usdt-change');
          bhChgEl.textContent = `${pos ? '+' : ''}${chgRate}% (${pos ? '+' : ''}${chgWon}원)`;
          bhChgEl.className = `change ${pos ? 'positive' : 'negative'}`;
        }

        // 5. 김치프리미엄 계산 (BTC 기준)
        if (upBtcKrw && btc && currentKrw) {
          const globalBtcKrw = btc.usd * currentKrw;
          const premium = ((upBtcKrw / globalBtcKrw) - 1) * 100;
          const premiumStr = premium.toFixed(2);
          const pos = premium >= 0;

          const kimchiEl = document.getElementById('kimchi-premium');
          kimchiEl.textContent = `${pos ? '+' : ''}${premiumStr}%`;
          kimchiEl.className = `value ${pos ? 'positive' : 'negative'}`;
        }
      } catch (err) {
        console.error('데이터 업데이트 오류:', err);
      }
    }

    // 즉시 실행 + 1분마다
    updateAllData();
    setInterval(updateAllData, 60 * 1000);
  </script>

</body>
</html>